<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta content='IE=edge' http-equiv='X-UA-Compatible'>
  <meta content='width=device-width, initial-scale=1.0' name='viewport'>
  <title>ImageService Testing UI</title>
</head>
<body style='font-family: system-ui'>
<h1>ImageService Testing UI</h1>
<p>
  1. You can load the files that are in the <code>image</code> directory:
</p>
<code>
  <a href='kitten.jpg'>http://localhost:3012/image/kitten.jpg</a><br />
  <a href='earth.png'>http://localhost:3012/image/earth.png</a>
</code>
<p>2. You can add images:</p>
<label for='avatar'>Choose an image:</label>
<input accept='image/jpeg' aria-label='avatar' id='avatar' name='avatar' type='file'>
<div>
  <button id='add'>Add image</button>
</div>
</body>
<script>
  const add = document.getElementById('add');
  const input = document.getElementById('avatar');

  const oop = async () => {
    const [file] = input.files;
    if (!file) return;

    console.log(file);

    const formData = new FormData();
    formData.append('file', file);
    // const buffer = await file.arrayBuffer();
    // const imageData = arrayBufferToBase64(buffer);
    // console.log(imageData);

    fetch('/images', {
      method: 'POST',
      body: formData,
    }).then(response => {
      console.log(response);
    });
  };

  // https://stackoverflow.com/a/9458996
  function arrayBufferToBase64(buffer) {
    let binary = '';
    const bytes = new Uint8Array(buffer);
    for (let i = 0; i < bytes.byteLength; i++) {
      binary += String.fromCharCode(bytes[i]);
    }
    return window.btoa(binary);
  }

  add.addEventListener('click', oop);
</script>
<style>
    * {
        color-scheme: light dark
    }
</style>
</html>
